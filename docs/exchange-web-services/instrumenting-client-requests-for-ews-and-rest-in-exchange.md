---
title: Instrumentação de solicitações de cliente para EWS e REST no Exchange
manager: sethgros
ms.date: 4/13/2016
ms.audience: Developer
localization_priority: Normal
ms.assetid: 330de503-498d-447e-b4a9-c20fc1699fd1
description: Saiba mais sobre os cabeçalhos HTTP no EWS e as solicitações REST e respostas que podem ajudá-lo a monitorar e solucionar problemas do aplicativo Exchange.
ms.openlocfilehash: 3a8ce889ec7a6b9e70ec25a95ac248902f48ca6c
ms.sourcegitcommit: 88ec988f2bb67c1866d06b361615f3674a24e795
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/31/2020
ms.locfileid: "44456301"
---
# <a name="instrumenting-client-requests-for-ews-and-rest-in-exchange"></a><span data-ttu-id="e5d20-103">Instrumentação de solicitações de cliente para EWS e REST no Exchange</span><span class="sxs-lookup"><span data-stu-id="e5d20-103">Instrumenting client requests for EWS and REST in Exchange</span></span>

<span data-ttu-id="e5d20-104">Saiba mais sobre os cabeçalhos HTTP no EWS e as solicitações REST e respostas que podem ajudá-lo a monitorar e solucionar problemas do aplicativo Exchange.</span><span class="sxs-lookup"><span data-stu-id="e5d20-104">Learn about the HTTP headers in EWS and REST requests and responses that can help you monitor and troubleshoot your Exchange application.</span></span>
  
<span data-ttu-id="e5d20-105">Isso já aconteceu?</span><span class="sxs-lookup"><span data-stu-id="e5d20-105">Has this ever happened to you?</span></span> <span data-ttu-id="e5d20-106">Um usuário do seu aplicativo relata um erro inesperado.</span><span class="sxs-lookup"><span data-stu-id="e5d20-106">A user of your application reports an unexpected error.</span></span> <span data-ttu-id="e5d20-107">Você deseja investigar, mas não pode reproduzi-lo.</span><span class="sxs-lookup"><span data-stu-id="e5d20-107">You want to investigate, but you can't reproduce it.</span></span> <span data-ttu-id="e5d20-108">O erro desapareceu para o usuário e você é deixado com poucos dados acionáveis.</span><span class="sxs-lookup"><span data-stu-id="e5d20-108">The error has disappeared for the user, and you're left with very little actionable data.</span></span> <span data-ttu-id="e5d20-109">Frustrante, não é?</span><span class="sxs-lookup"><span data-stu-id="e5d20-109">Frustrating, isn't it?</span></span> <span data-ttu-id="e5d20-110">Vamos ver como você pode se preparar proativamente para este cenário e, espero, evitar frustração no futuro.</span><span class="sxs-lookup"><span data-stu-id="e5d20-110">Let's look at how you can proactively prepare for this scenario and hopefully avoid frustration in the future.</span></span>
  
## <a name="add-instrumentation-to-requests"></a><span data-ttu-id="e5d20-111">Adicionar instrumentação às solicitações</span><span class="sxs-lookup"><span data-stu-id="e5d20-111">Add instrumentation to requests</span></span>

<span data-ttu-id="e5d20-112">Recomendamos que você adicione outros cabeçalhos HTTP às suas solicitações para facilitar a solução de problemas.</span><span class="sxs-lookup"><span data-stu-id="e5d20-112">We recommend that you add additional HTTP headers to your requests to facilitate troubleshooting.</span></span> <span data-ttu-id="e5d20-113">Você deve manter um registro dessas informações em algum lugar (por exemplo, em um arquivo de log) para que possa recuperá-lo posteriormente, se necessário.</span><span class="sxs-lookup"><span data-stu-id="e5d20-113">You should keep a record of this information somewhere (for example, in a log file) so that you can retrieve it later if you need to.</span></span> <span data-ttu-id="e5d20-114">Isso é útil ao examinar o tráfego de rede e também é útil se você entrar em contato com o suporte da Microsoft para obter assistência.</span><span class="sxs-lookup"><span data-stu-id="e5d20-114">This is helpful when examining network traffic, and is also helpful if you contact Microsoft support for assistance.</span></span>
  
<span data-ttu-id="e5d20-115">**Tabela 1. Cabeçalhos de solicitação para solução de problemas**</span><span class="sxs-lookup"><span data-stu-id="e5d20-115">**Table 1. Request headers for troubleshooting**</span></span>

|<span data-ttu-id="e5d20-116">**Cabeçalho HTTP (EWS)**</span><span class="sxs-lookup"><span data-stu-id="e5d20-116">**HTTP header (EWS)**</span></span>|<span data-ttu-id="e5d20-117">**Equivalente à API gerenciada do EWS**</span><span class="sxs-lookup"><span data-stu-id="e5d20-117">**EWS Managed API equivalent**</span></span>|<span data-ttu-id="e5d20-118">**Anotações**</span><span class="sxs-lookup"><span data-stu-id="e5d20-118">**Notes**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="e5d20-119">Agente de usuário</span><span class="sxs-lookup"><span data-stu-id="e5d20-119">User-Agent</span></span>  <br/> |[<span data-ttu-id="e5d20-120">ExchangeService. UserAgent</span><span class="sxs-lookup"><span data-stu-id="e5d20-120">ExchangeService.UserAgent</span></span>](https://msdn.microsoft.com/library/microsoft.exchange.webservices.data.exchangeservicebase.useragent%28v=exchg.80%29.aspx) <br/> |<span data-ttu-id="e5d20-121">Defina isso como um valor exclusivo que identifique o aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="e5d20-121">Set this to a unique value that identifies your client application.</span></span><br/><br/> <span data-ttu-id="e5d20-122">Usar o mesmo valor para todas as solicitações que o seu aplicativo envia permite que a Microsoft ajude a solucionar problemas de falhas de chamada, caso ocorram.</span><span class="sxs-lookup"><span data-stu-id="e5d20-122">Using the same value for all requests that your application sends allows Microsoft to help troubleshoot call failures, should they arise.</span></span>  <br/> |
|<span data-ttu-id="e5d20-123">Client-Request-ID</span><span class="sxs-lookup"><span data-stu-id="e5d20-123">client-request-id</span></span>  <br/> |[<span data-ttu-id="e5d20-124">ExchangeService. ClientRequestId</span><span class="sxs-lookup"><span data-stu-id="e5d20-124">ExchangeService.ClientRequestId</span></span>](https://msdn.microsoft.com/library/microsoft.exchange.webservices.data.exchangeservicebase.clientrequestid%28v=exchg.80%29.aspx) <br/> |<span data-ttu-id="e5d20-125">Defina isso como um valor exclusivo diferente para cada solicitação que seu aplicativo envia.</span><span class="sxs-lookup"><span data-stu-id="e5d20-125">Set this to a different unique value for every request your application sends.</span></span><br/><br/> <span data-ttu-id="e5d20-126">Recomendamos que você use um GUID.</span><span class="sxs-lookup"><span data-stu-id="e5d20-126">We recommend that you use a GUID.</span></span> <span data-ttu-id="e5d20-127">Esse identificador exclusivo deve ser usado para correlacionar atividades entre dois sistemas no caso de algo errado.</span><span class="sxs-lookup"><span data-stu-id="e5d20-127">This unique identifier is intended to be used to correlate activities between two systems in the event that something goes wrong.</span></span>  <br/> |
|<span data-ttu-id="e5d20-128">retorno-Client-Request-ID</span><span class="sxs-lookup"><span data-stu-id="e5d20-128">return-client-request-id</span></span>  <br/> |[<span data-ttu-id="e5d20-129">ExchangeService. ReturnClientRequestId</span><span class="sxs-lookup"><span data-stu-id="e5d20-129">ExchangeService.ReturnClientRequestId</span></span>](https://msdn.microsoft.com/library/microsoft.exchange.webservices.data.exchangeservicebase.returnclientrequestid%28v=exchg.80%29.aspx) <br/> |<span data-ttu-id="e5d20-130">Defina como **true** para sinalizar para o servidor Exchange que deve retornar o valor de seu Client-Request-ID na resposta correspondente.</span><span class="sxs-lookup"><span data-stu-id="e5d20-130">Set this to **true** to signal to the Exchange server that it should return the value of your client-request-id in the corresponding response.</span></span><br/><br/> <span data-ttu-id="e5d20-131">Você pode usar isso para correlacionar solicitações e respostas em rastreamentos de rede ou rastreamentos de API gerenciada do EWS.</span><span class="sxs-lookup"><span data-stu-id="e5d20-131">You can use this to correlate requests and responses in network traces or EWS Managed API traces.</span></span>  <br/> |
|<span data-ttu-id="e5d20-132">X-ClientStatistics</span><span class="sxs-lookup"><span data-stu-id="e5d20-132">X-ClientStatistics</span></span>  <br/> |[<span data-ttu-id="e5d20-133">ExchangeService. SendClientLatencies</span><span class="sxs-lookup"><span data-stu-id="e5d20-133">ExchangeService.SendClientLatencies</span></span>](https://msdn.microsoft.com/library/microsoft.exchange.webservices.data.exchangeservicebase.sendclientlatencies%28v=exchg.80%29.aspx) <br/> |<span data-ttu-id="e5d20-134">Usado para [relatar latências de EWS](#bk_ReportLatency) para a Microsoft se seu aplicativo estiver acessando o Exchange Online ou o Exchange Online como parte do Office 365.</span><span class="sxs-lookup"><span data-stu-id="e5d20-134">Used to [report EWS latencies](#bk_ReportLatency) to Microsoft if your application is accessing Exchange Online or Exchange Online as part of Office 365.</span></span>  <br/> |
   
## <a name="log-information-from-responses"></a><span data-ttu-id="e5d20-135">Informações de log de respostas</span><span class="sxs-lookup"><span data-stu-id="e5d20-135">Log information from responses</span></span>

<span data-ttu-id="e5d20-136">Assim que o cliente pode adicionar a instrumentação adicional às solicitações que envia, o Exchange adiciona instrumentação adicional às respostas na forma de cabeçalhos HTTP.</span><span class="sxs-lookup"><span data-stu-id="e5d20-136">Just as your client can add additional instrumentation to the requests it sends, Exchange adds additional instrumentation to the responses in the form of HTTP headers.</span></span> <span data-ttu-id="e5d20-137">O cliente deve capturar essas informações para acompanhar as informações de instrumentação de solicitação.</span><span class="sxs-lookup"><span data-stu-id="e5d20-137">Your client should capture this information to go along with the request instrumentation information.</span></span>
  
> [!NOTE]
> <span data-ttu-id="e5d20-138">Se você estiver usando a API gerenciada do EWS, não haverá equivalente direto aos cabeçalhos HTTP.</span><span class="sxs-lookup"><span data-stu-id="e5d20-138">If you are using the EWS Managed API, there is no direct equivalent for the HTTP headers.</span></span> <span data-ttu-id="e5d20-139">No entanto, todos os cabeçalhos de resposta HTTP podem ser acessados por meio da propriedade [ExchangeService. HttpResponseHeaders](https://msdn.microsoft.com/library/microsoft.exchange.webservices.data.exchangeservicebase.httpresponseheaders%28v=exchg.80%29.aspx) .</span><span class="sxs-lookup"><span data-stu-id="e5d20-139">However, all HTTP response headers can be accessed via the [ExchangeService.HttpResponseHeaders](https://msdn.microsoft.com/library/microsoft.exchange.webservices.data.exchangeservicebase.httpresponseheaders%28v=exchg.80%29.aspx) property.</span></span> 
  
<span data-ttu-id="e5d20-140">**Tabela 2. Cabeçalhos de resposta HTTP**</span><span class="sxs-lookup"><span data-stu-id="e5d20-140">**Table 2. HTTP response headers**</span></span>

|<span data-ttu-id="e5d20-141">**Cabeçalho HTTP**</span><span class="sxs-lookup"><span data-stu-id="e5d20-141">**HTTP header**</span></span>|<span data-ttu-id="e5d20-142">**Descrição**</span><span class="sxs-lookup"><span data-stu-id="e5d20-142">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="e5d20-143">ID da solicitação</span><span class="sxs-lookup"><span data-stu-id="e5d20-143">request-id</span></span>  <br/> |<span data-ttu-id="e5d20-144">Uma ID gerada pelo servidor para a solicitação que corresponde a essa resposta.</span><span class="sxs-lookup"><span data-stu-id="e5d20-144">A server-generated ID for the request that corresponds to this response.</span></span>  <br/> |
|<span data-ttu-id="e5d20-145">Client-Request-ID</span><span class="sxs-lookup"><span data-stu-id="e5d20-145">client-request-id</span></span>  <br/> |<span data-ttu-id="e5d20-146">O valor do cabeçalho Client-Request-ID na solicitação.</span><span class="sxs-lookup"><span data-stu-id="e5d20-146">The value of the client-request-id header in the request.</span></span><br/><br/> <span data-ttu-id="e5d20-147">Este cabeçalho só estará presente se a solicitação contiver o cabeçalho Return-Client-Request-ID com um valor **true**.</span><span class="sxs-lookup"><span data-stu-id="e5d20-147">This header is only present if the request contains the return-client-request-id header with a value of **true**.</span></span>  <br/> |
|<span data-ttu-id="e5d20-148">X-FEServer</span><span class="sxs-lookup"><span data-stu-id="e5d20-148">X-FEServer</span></span>  <br/> |<span data-ttu-id="e5d20-149">O FQDN do servidor de acesso para cliente que processou a solicitação.</span><span class="sxs-lookup"><span data-stu-id="e5d20-149">The FQDN of the Client Access server that processed the request.</span></span>  <br/> |
|<span data-ttu-id="e5d20-150">X-TargetBEServer</span><span class="sxs-lookup"><span data-stu-id="e5d20-150">X-TargetBEServer</span></span>  <br/> |<span data-ttu-id="e5d20-151">O FQDN do servidor de caixa de correio que processou a solicitação.</span><span class="sxs-lookup"><span data-stu-id="e5d20-151">The FQDN of the mailbox server that processed the request.</span></span>  <br/> |
|<span data-ttu-id="e5d20-152">X-DiagInfo</span><span class="sxs-lookup"><span data-stu-id="e5d20-152">X-DiagInfo</span></span>  <br/> |<span data-ttu-id="e5d20-153">Informações adicionais de diagnóstico, dependendo da solicitação.</span><span class="sxs-lookup"><span data-stu-id="e5d20-153">Additional diagnostic information, depending on the request.</span></span>  <br/> |
|<span data-ttu-id="e5d20-154">x-MS-Diagnostics</span><span class="sxs-lookup"><span data-stu-id="e5d20-154">x-ms-diagnostics</span></span>  <br/> | <span data-ttu-id="e5d20-155">Esse cabeçalho só será aplicável se a autenticação OAuth for usada na solicitação.</span><span class="sxs-lookup"><span data-stu-id="e5d20-155">This header is only applicable if OAuth authentication is used in the request.</span></span><br/><br/> <span data-ttu-id="e5d20-156">Ele contém um código de erro explícito que especifica por que uma autenticação OAuth falhou.</span><span class="sxs-lookup"><span data-stu-id="e5d20-156">It contains an explicit error code that specifies why an OAuth authentication failed.</span></span><br/><br/> <span data-ttu-id="e5d20-157">Ele tem o seguinte formato:`errorId;reason="reason"error_type="error type"`</span><span class="sxs-lookup"><span data-stu-id="e5d20-157">It takes the following format: `errorId;reason="reason"error_type="error type"`</span></span><br/><br/> <span data-ttu-id="e5d20-158">O campo de **motivo** é uma descrição legível do erro.</span><span class="sxs-lookup"><span data-stu-id="e5d20-158">The **reason** field is a human-readable description of the error.</span></span><br/><br/> <span data-ttu-id="e5d20-159">O campo **errorID** é um inteiro e o campo \*\* \_ tipo de erro\*\* é a representação de cadeia de caracteres desse inteiro, da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="e5d20-159">The **errorId** field is an integer, and the **error\_type** field is the string representation of that integer, as follows:</span></span><ul><li><span data-ttu-id="e5d20-160">2 milhões: assinatura inválida \_</span><span class="sxs-lookup"><span data-stu-id="e5d20-160">2000000: invalid\_signature</span></span></li><li><span data-ttu-id="e5d20-161">2000001: \_ token inválido</span><span class="sxs-lookup"><span data-stu-id="e5d20-161">2000001: invalid\_token</span></span></li><li>  <span data-ttu-id="e5d20-162">2000002: token \_ expirado</span><span class="sxs-lookup"><span data-stu-id="e5d20-162">2000002: token\_expired</span></span></li><li><span data-ttu-id="e5d20-163">2000003: \_ recurso inválido</span><span class="sxs-lookup"><span data-stu-id="e5d20-163">2000003: invalid\_resource</span></span></li><li><span data-ttu-id="e5d20-164">2000004: \_ locatário inválido</span><span class="sxs-lookup"><span data-stu-id="e5d20-164">2000004: invalid\_tenant</span></span>  </li><li><span data-ttu-id="e5d20-165">2000005: \_ usuário inválido</span><span class="sxs-lookup"><span data-stu-id="e5d20-165">2000005: invalid\_user</span></span></li><li><span data-ttu-id="e5d20-166">2000006: \_ cliente inválido</span><span class="sxs-lookup"><span data-stu-id="e5d20-166">2000006: invalid\_client</span></span></li><li><span data-ttu-id="e5d20-167">2000007: \_ erro interno</span><span class="sxs-lookup"><span data-stu-id="e5d20-167">2000007: internal\_error</span></span></li><li><span data-ttu-id="e5d20-168">2000008: concessão inválida \_</span><span class="sxs-lookup"><span data-stu-id="e5d20-168">2000008: invalid\_grant</span></span></li></ul> |
   
## <a name="report-ews-latency-to-microsoft"></a><span data-ttu-id="e5d20-169">Relatar a latência do EWS para a Microsoft</span><span class="sxs-lookup"><span data-stu-id="e5d20-169">Report EWS latency to Microsoft</span></span>
<span data-ttu-id="e5d20-170"><a name="bk_ReportLatency"> </a></span><span class="sxs-lookup"><span data-stu-id="e5d20-170"><a name="bk_ReportLatency"> </a></span></span>

<span data-ttu-id="e5d20-171">Se o aplicativo usar a API gerenciada do EWS ou o EWS para se conectar ao Exchange Online, você poderá relatar a latência em solicitações EWS diretamente à Microsoft.</span><span class="sxs-lookup"><span data-stu-id="e5d20-171">If your application uses the EWS Managed API or EWS to connect to Exchange Online, you can report latency in EWS requests directly to Microsoft.</span></span> <span data-ttu-id="e5d20-172">As informações são passadas pelo cabeçalho de solicitação X-ClientStatistics.</span><span class="sxs-lookup"><span data-stu-id="e5d20-172">The information is passed via the X-ClientStatistics request header.</span></span> <span data-ttu-id="e5d20-173">Se você estiver usando a API gerenciada do EWS, tudo o que você precisa fazer é definir a propriedade [ExchangeService. SendClientLatencies](https://msdn.microsoft.com/library/microsoft.exchange.webservices.data.exchangeservicebase.sendclientlatencies%28v=exchg.80%29.aspx) como **true**.</span><span class="sxs-lookup"><span data-stu-id="e5d20-173">If you are using the EWS Managed API, all you have to do is set the [ExchangeService.SendClientLatencies](https://msdn.microsoft.com/library/microsoft.exchange.webservices.data.exchangeservicebase.sendclientlatencies%28v=exchg.80%29.aspx) property to **true**.</span></span> <span data-ttu-id="e5d20-174">Se você estiver usando o EWS, precisará medir o tempo entre a emissão de uma solicitação e o recebimento de uma resposta e, em seguida, adicione o cabeçalho X-ClientStatistics à próxima solicitação do EWS que seu aplicativo envia, usando o formato a seguir.</span><span class="sxs-lookup"><span data-stu-id="e5d20-174">If you are using EWS, you'll need to measure the time between issuing a request and receiving a response, then add the X-ClientStatistics header to the next EWS request your application sends, using the following format.</span></span>
  
`X-ClientStatistics: MessageId=<value of request-id header>,ResponseTime=<time in milliseconds>,SoapAction=<EWS operation>`
  
<span data-ttu-id="e5d20-175">Mantemos relatórios para essas latências e os usam para melhorar continuamente os serviços do EWS no Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="e5d20-175">We maintain reports for these latencies and use them to continuously improve EWS services in Exchange Online.</span></span>
  
## <a name="next-steps"></a><span data-ttu-id="e5d20-176">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="e5d20-176">Next steps</span></span>
<span data-ttu-id="e5d20-177"><a name="bk_ReportLatency"> </a></span><span class="sxs-lookup"><span data-stu-id="e5d20-177"><a name="bk_ReportLatency"> </a></span></span>

<span data-ttu-id="e5d20-178">Após ter adicionado a instrumentação do cliente ao seu aplicativo, você estará mais preparado se algo der errado.</span><span class="sxs-lookup"><span data-stu-id="e5d20-178">After you've added client instrumentation to your application, you're better prepared if something goes wrong.</span></span> <span data-ttu-id="e5d20-179">Se isso acontecer, você poderá usar seus dados de instrumentação para [solucionar problemas com o aplicativo](tools-and-resources-for-troubleshooting-ews-applications-for-exchange.md).</span><span class="sxs-lookup"><span data-stu-id="e5d20-179">If that happens, you can use your instrumentation data to [troubleshoot your application](tools-and-resources-for-troubleshooting-ews-applications-for-exchange.md).</span></span>
  
## <a name="see-also"></a><span data-ttu-id="e5d20-180">Também consulte</span><span class="sxs-lookup"><span data-stu-id="e5d20-180">See also</span></span>

- [<span data-ttu-id="e5d20-181">Visão geral do design de cliente do EWS para Exchange</span><span class="sxs-lookup"><span data-stu-id="e5d20-181">EWS client design overview for Exchange</span></span>](ews-client-design-overview-for-exchange.md)
- [<span data-ttu-id="e5d20-182">Rastrear solicitações e respostas para solucionar problemas de aplicativos de API gerenciada do EWS</span><span class="sxs-lookup"><span data-stu-id="e5d20-182">Trace requests and responses to troubleshoot EWS Managed API applications</span></span>](how-to-trace-requests-responses-to-troubleshoot-ews-managed-api-applications.md)
- [<span data-ttu-id="e5d20-183">Ferramentas e recursos para a solução de problemas de aplicativos do EWS para Exchange</span><span class="sxs-lookup"><span data-stu-id="e5d20-183">Tools and resources for troubleshooting EWS applications for Exchange</span></span>](tools-and-resources-for-troubleshooting-ews-applications-for-exchange.md)
    

